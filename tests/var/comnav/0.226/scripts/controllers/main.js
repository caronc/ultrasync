"use strict";var name;var pin;var sess_id;var user_level;var is_app;var g_auto_logout_ctr=IDLE_TIMEOUT_TICK;var SESSION_TICK_S=1;var IDLE_TIMEOUT_TICK=(5*60);var STATUS_REFRESH_TICK=5;var UserLevelEnum={NONE:0,MASTER_INSTALLER:1,INSTALLER:2,MASTER:3,USER:4};function isUserMaster(a){return(a==UserLevelEnum.MASTER_INSTALLER||a==UserLevelEnum.MASTER)}function isUserInstaller(a){return(a==UserLevelEnum.MASTER_INSTALLER||a==UserLevelEnum.INSTALLER)}function setNamePin(e,b,a,c,g,d,f){name=e;sess_id=a;user_level=c;is_app=parseInt(f)>0;setRegion(d);setLang(g)}function dynamicSort(b){var a=1;if(b[0]==="-"){a=-1;b=b.substr(1)}return function(e,d){var c=(e[b]<d[b])?-1:(e[b]>d[b])?1:0;return c*a}}function capitalize(a){return a[0].toUpperCase()+a.slice(1)}function resultAlert(a){if(a==null||typeof a!=="object"){alert(trl("Please logout and login again"))}else{alert(a.error.message)}}var RoomActionEnum={GET_SINGLE:0,SET_ATT:1,ADD_MODE:2,REM_MODE:3,READY_MODE:4};var RoomTypeEnum={SWITCH:0,THERMO:1,LOCK:2};angular.module("ngAppApp").factory("Updater",["usSpinnerService","$timeout",function(c,d){var b={};b.errMsg="";b.spinneractive=false;b.cmdEnum={AREAS_GET:0,AREAS_SET:1,ZONES_GET:2,ZONES_SET:3,HISTORY_GET:4,HAUTO_GET:5,HAUTO_SET:6,HAUTO_ADD:7,HAUTO_REMOVE:8,HAUTO_STOP_ADD_REMOVE:9,HAUTO_RESET:10,CONFIG_GET:11,SCENES_GET:12,CONFIG_SET:13,STATUS_GET:14,SESSION_POLL:15,LOGOUT:16,DISPLAY_GET:17,KPDATA_SEND:18,EVLOG_GET_NEXT:19,EVLOG_GET_PREV:20,USERS_GET:21,USER_SET:22,FACTORY_DEFAULT:23,COPY_CHANGED_NAMES:24,COPY_ALL_NAMES:25,SCAN_CAMERAS:26};b.sendUpdate=function a(l,j,m,f,n){var i={"":""};for(var g in m){i[g]=m[g]}var e={se:sess_id,cmd:f,da:i};var h=new Uint8Array(msgpack.pack(e));var k=new XMLHttpRequest;k.open("POST","data.json",true);k.responseType="arraybuffer";k.timeout=30000;k.ontimeout=function(o){};if(j!=undefined){j()}if(!b.spinneractive){c.spin("spinner-1");b.spinneractive=true}k.onreadystatechange=function(){b.spinneractive=false;c.stop("spinner-1");b.errMsg="";if(k.readyState==4){if(k.status==200){if((typeof k.responseURL!=="undefined")&&(k.responseURL.indexOf("data.json")==-1)){document.open();document.write(String.fromCharCode.apply(null,new Uint8Array(k.response)));document.close();if(n!=undefined){n(null)}}else{var o=msgpack.unpack(new Uint8Array(k.response));if(n!=undefined){n(o);d(function(){l.$apply()})}}}else{if(k.status==404){window.location="/login.htm";if(n!=undefined){n(null)}}else{if(n!=undefined){n(null)}}}}};k.send(h)};return b}]);angular.module("ngAppApp").factory("Poller",["Updater","$interval","$timeout",function(d,c,a){var g={};g.sessionPoll=function i(){d.sendUpdate(undefined,undefined,null,d.cmdEnum.SESSION_POLL,undefined)};g.setStatusRefresh=function e(k,m,n,l){g.scope=m;g.cmd=n;g.statusSet=l;g.status_refresh_ctr=g.statusRefresh=k};g.cancel=function(){c.cancel(g.session_tick_timer)};g.stopStatusRefresh=function b(){g.setStatusRefresh(0,null,-1,null)};g.resetSession=function j(){g_auto_logout_ctr=IDLE_TIMEOUT_TICK;g.sessionPoll();g.status_refresh_ctr=g.statusRefresh};g.updateStatus=function h(){if(g.cmd>=0&&g.scope!=null&&g.statusSet!=null){d.sendUpdate(g.scope,undefined,null,g.cmd,function(k){if(k!=null){g.statusSet(k)}})}};g.sessionTick=function f(){if((g_auto_logout_ctr>0)&&(--g_auto_logout_ctr==0)){d.sendUpdate(g.scope,undefined,null,d.cmdEnum.LOGOUT,undefined);window.location="/login.htm?code=2";g.cancel();g.status_refresh_ctr=g.statusRefresh=0}else{if((g.status_refresh_ctr>0)&&(--g.status_refresh_ctr==0)){g.updateStatus();a(function(){g.scope.$apply()});g.status_refresh_ctr=g.statusRefresh}}};g.stopStatusRefresh();g.resetSession();g.session_tick_timer=c(g.sessionTick,SESSION_TICK_S*1000);return g}]);function get_menu(){var a=[{title:trl("Arm/Disarm"),link:"#/areas"},{title:trl("Zones"),link:"#/zones"},{title:trl("History"),link:"#/events"},{title:trl("Users"),link:"#/users"},{title:trl("Settings"),link:"#/settings"},{title:trl("Logout"),link:"#/logout"}];var b=[{title:trl("Arm/Disarm"),link:"#/areas"},{title:trl("Zones"),link:"#/zones"},{title:trl("History"),link:"#/events"},{title:trl("Settings"),link:"#/settings"},{title:trl("Logout"),link:"#/logout"}];var c=[{title:trl("Arm/Disarm"),link:"#/areas"},{title:trl("Zones"),link:"#/zones"},{title:trl("Users"),link:"#/users"},{title:trl("Settings"),link:"#/settings"},{title:trl("Logout"),link:"#/logout"}];if(isUserMaster(user_level)){return a}else{if(user_level==UserLevelEnum.USER){return c}else{return b}}}angular.module("ngAppApp").filter("bwAND",function(){return function(d,c){d=parseInt(d);c=parseInt(c);return((d&c)===c)}});angular.module("ngAppApp").filter("bwOR",function(){return function(d,c){d=parseInt(d);c=parseInt(c);return((d|c)!==0)}});angular.module("ngAppApp").filter("trl",function(){return function(a){return trl(a)}});angular.module("ngAppApp").controller("MenuController",["$scope","$timeout","$interval","$http","Updater","Poller",function(a,b,e,f,d,c){a.region_eu=region_eu;a.device_region=g_device_region;a.desktop_mode=getmode();a.MenuShow=function(){var g=document.getElementById("mnu");g.style.display=((g.style.display!="block")?"block":"none")}}]);angular.module("ngAppApp").controller("ShowAreasController",["$scope","$timeout","$interval","$http","Updater","Poller",function(l,c,g,j,h,b){l.menu=get_menu();l.desktop_mode=getmode();l.invalid_area="!";var e;var d=0;var a=menu_str[WORDS_SYSTEM_OK];var k={AWAY:0,STAY:1,DISARM:2,CHIME:3,UNCHIME:4};var i={AWAY:1,STAY:2,DISARM:4,CHIME:8,READY:16,ALARMED:32,ZONE_BYPASSED:64,ZONE_TROUBLE:128,ZONE_FAULT:256,ZONE_TAMPER:512,ZONE_LOW_BATT:1024,ZONE_LOST:2048,FIRE:4096,FIRE_TROUBLE:8192,EXIT_1:16384,EXIT_2:32768,ENTRY:65536,NO_DELAY:131072,NIGHT_MODE:262144};var f=[{st:0,word:trl("Ready")},{st:i.AWAY,word:trl("Armed Away")},{st:i.STAY,word:trl("Armed Stay")},{st:i.ALARMED,word:trl("Burg Alarm")},{st:i.ZONE_BYPASSED,word:trl("Zone Bypassed")},{st:i.ZONE_FAULT,word:trl("Not Ready")},{st:i.ZONE_TROUBLE,word:trl("Zone Trouble")},{st:i.ZONE_TAMPER,word:trl("Zone Tamper")},{st:i.ZONE_LOW_BATT,word:trl("Zone Low Battery")},{st:i.ZONE_LOST,word:trl("Zone Supervision")},{st:i.FIRE,word:trl("Fire")},{st:i.FIRE_TROUBLE,word:trl("Fire Trouble")},{st:i.EXIT_1,word:trl("Exit Delay")},{st:i.EXIT_2,word:trl("Exit Delay 2")},{st:i.ENTRY,word:trl("Entry Delay")},{st:i.NIGHT_MODE,word:trl("Night Mode")}];l.areas=[];l.sys=[];l.menu=get_menu();l.updater=h;l.poller=b;l.display_areas=false;l.UpdateSys=function(m){l.sys=m.split(",")};l.UpdateAreas=function(m){m.map(function(n){l.areas[n.id]=l.areas[n.id]||{};l.areas[n.id].properties=n;if(l.areas[n.id].properties.na==""){l.areas[n.id].properties.na=trl("Area")+" "+(n.id+1).toString()}})};l.UpdateResult=function(m){l.UpdateAreas(m.areas);l.UpdateSys(m.sys);l.display_areas=true};b.setStatusRefresh(STATUS_REFRESH_TICK,l,l.updater.cmdEnum.AREAS_GET,l.UpdateResult);l.UpdateMessages=function(){l.areas.map(function(m){var n;for(n=0;n<f.length;n++,m.midx=(m.midx+1)%f.length){if(f[m.midx].st&m.properties.st){m.message=f[m.midx].word;m.midx=(m.midx+1)%f.length;break}m.message=f[0].word}});if(l.sys.length>0){d=(d+1)%l.sys.length;l.sys_msg=l.sys[d]}c(function(){l.$apply()})};l.updater.sendUpdate(l,undefined,null,l.updater.cmdEnum.AREAS_GET,function(m){l.UpdateResult(m);l.areas.map(function(n){if(n.midx==null){n.midx=0}});l.UpdateMessages();e=g(l.UpdateMessages,2000)});l.getSysBoxClass=function(){if(l.sys.length==1&&l.sys[0]==a){return"bg-grn"}else{return"bg-red"}};l.Away=function(n){b.resetSession();if(!(l.areas[n].properties.st&i.AWAY)){var m={id:1<<n,cmd:k.AWAY};l.updater.sendUpdate(l,undefined,m,l.updater.cmdEnum.AREAS_SET,function(o){l.UpdateResult(o)})}};l.Stay=function(n){b.resetSession();if(!(l.areas[n].properties.st&i.STAY)){var m={id:1<<n,cmd:k.STAY};l.updater.sendUpdate(l,undefined,m,l.updater.cmdEnum.AREAS_SET,function(o){l.UpdateResult(o)})}};l.Off=function(n){b.resetSession();if(l.areas[n].properties.st&(i.AWAY|i.STAY)){var m={id:1<<n,cmd:k.DISARM};l.updater.sendUpdate(l,undefined,m,l.updater.cmdEnum.AREAS_SET,function(o){l.UpdateResult(o)})}};l.Away_All=function(){b.resetSession();var m={id:255,cmd:k.AWAY};l.updater.sendUpdate(l,undefined,m,l.updater.cmdEnum.AREAS_SET,function(n){l.UpdateResult(n)})};l.Stay_All=function(){b.resetSession();var m={id:255,cmd:k.STAY};l.updater.sendUpdate(l,undefined,m,l.updater.cmdEnum.AREAS_SET,function(n){l.UpdateResult(n)})};l.Off_All=function(){b.resetSession();var m={id:255,cmd:k.DISARM};l.updater.sendUpdate(l,undefined,m,l.updater.cmdEnum.AREAS_SET,function(n){l.UpdateResult(n)})};l.Chime=function(n){b.resetSession();var m;if(l.areas[n].properties.st&i.CHIME){m={id:1<<n,cmd:k.UNCHIME}}else{m={id:1<<n,cmd:k.CHIME}}l.updater.sendUpdate(l,undefined,m,l.updater.cmdEnum.AREAS_SET,function(o){l.UpdateResult(o)})};l.getAreaBoxClass=function(n){var m=i.ZONE_TROUBLE|i.ZONE_TAMPER|i.ZONE_LOW_BATT|i.ZONE_LOST;if(l.areas[n].properties.st&i.ALARMED){return"bg-red"}else{if(l.areas[n].properties.st&m){return"bg-blue"}else{if(l.areas[n].properties.st&i.ZONE_BYPASSED){return"bg-yel"}else{if(l.areas[n].properties.st&i.AWAY){return"bg-red"}else{if(l.areas[n].properties.st&i.STAY){return"bg-yel"}else{if(l.areas[n].properties.st&i.READY){return"bg-grn"}else{return"bg-gry"}}}}}}};l.getButtonClassAway=function(m){if(l.areas[m].properties.st&i.AWAY){return"bg-red"}else{return"bg-gry"}};l.getButtonClassStay=function(m){if(l.areas[m].properties.st&i.STAY){return"bg-yel"}else{return"bg-gry"}};l.getButtonClassChime=function(m){if(l.areas[m].properties.st&i.CHIME){return"bg-blu"}else{return"bg-gry"}};l.$on("$destroy",function(){g.cancel(e);b.stopStatusRefresh()})}]);angular.module("ngAppApp").controller("ShowZonesController",["$scope","$interval","$http","Updater","Poller",function(i,e,h,f,b){i.menu=get_menu();i.desktop_mode=getmode();i.invalid_zone="!";i.display_zones=false;var d;var g={BYPASS:0,UNBYPASS:1,CHIME:2,UNCHIME:3};var a={FAULT:1,BYPASS:2,CHIME:4,TROUBLE:8,TAMPER:16,LOW_BATT:32,ALARM:64};var c=[{st:0,word:trl("Ready")},{st:a.TROUBLE,word:trl("Trouble")},{st:a.TAMPER,word:trl("Tamper")},{st:a.FAULT,word:trl("Not Ready")},{st:a.LOW_BATT,word:trl("Low Battery")},{st:a.ALARM,word:trl("Alarm")}];i.zones=[];i.updater=f;i.poller=b;i.UpdateZones=function(j){i.display_zones=false;j.map(function(k){i.zones[k.id]=i.zones[k.id]||{};i.zones[k.id].properties=k;if(i.zones[k.id].properties.na==""){i.zones[k.id].properties.na=trl("Zone")+" "+(k.id+1).toString()}});i.display_zones=true};b.setStatusRefresh(STATUS_REFRESH_TICK,i,i.updater.cmdEnum.ZONES_GET,i.UpdateZones);i.UpdateMessages=function(){i.zones.map(function(k){var j;for(j=0;j<c.length;j++,k.midx=(k.midx+1)%c.length){if(c[k.midx].st&k.properties.st){k.message=c[k.midx].word;k.midx=(k.midx+1)%c.length;return}k.message=c[0].word}})};i.updater.sendUpdate(i,undefined,null,i.updater.cmdEnum.ZONES_GET,function(j){i.UpdateZones(j);i.zones.map(function(k){if(k.midx==null){k.midx=0}});i.UpdateMessages();d=e(i.UpdateMessages,2000)});i.Bypass=function(l){b.resetSession();var k;var j;for(j=0;j<i.zones.length&&i.zones[j].properties.id!=l;j++){}if(i.zones[j].properties.st&a.BYPASS){k={id:l,cmd:g.UNBYPASS}}else{k={id:l,cmd:g.BYPASS}}i.updater.sendUpdate(i,undefined,k,i.updater.cmdEnum.ZONES_SET,function(m){i.UpdateZones(m)})};i.Chime=function(l){b.resetSession();var k;var j;for(j=0;j<i.zones.length&&i.zones[j].properties.id!=l;j++){}if(i.zones[j].properties.st&a.CHIME){k={id:l,cmd:g.UNCHIME}}else{k={id:l,cmd:g.CHIME}}i.updater.sendUpdate(i,undefined,k,i.updater.cmdEnum.ZONES_SET,function(m){i.UpdateZones(m)})};i.getBoxClass=function(k){var j;for(j=0;j<i.zones.length&&i.zones[j].properties.id!=k;j++){}if(i.zones[j].properties.st&a.ALARM){return"bg-red"}else{if(i.zones[j].properties.st&(a.TROUBLE|a.TAMPER|a.LOW_BATT)){return"bg-blu"}else{if(i.zones[j].properties.st&a.FAULT){return"bg-gry"}else{if(i.zones[j].properties.st&a.BYPASS){return"bg-yel"}else{return"bg-grn"}}}}};i.getButtonClassChime=function(k){var j;for(j=0;j<i.zones.length&&i.zones[j].properties.id!=k;j++){}if(i.zones[j].properties.st&a.CHIME){return"bg-blu"}else{return"bg-gry"}};i.getButtonClassBypass=function(k){var j;for(j=0;j<i.zones.length&&i.zones[j].properties.id!=k;j++){}if(i.zones[j].properties.st&a.BYPASS){return"bg-yel"}else{return"bg-gry"}};i.$on("$destroy",function(){b.stopStatusRefresh();e.cancel(d)})}]);var g_cameraUrlUpdated=false;angular.module("ngAppApp").controller("ShowCamerasController",["$scope","$interval","$http","Poller",function(b,f,g,e){b.menu=get_menu();b.desktop_mode=getmode();e.stopStatusRefresh();b.cameras=[];var d=0;var a=getCameras();if(!a){return}var c=JSON.parse(a.replace(/^"(.*)"$/,"$1"));c.cameras.forEach(function(i){var h={};h.id_box="camera"+(d+1);h.id_img="img"+(d+1);h.name=i.name;b.cameras[d++]=h});b.cameras.forEach(function(h){b.cameras.updater=f(function(){var j=document.getElementById(h.id_img).getAttribute("src");var i=j.split("&time=")[0]+"&time="+new Date().getTime();document.getElementById(h.id_img).setAttribute("src",i)},10000)});if(g_cameraUrlUpdated==false){window.location=window.location.href+"?model=331";g_cameraUrlUpdated=true}}]);angular.module("ngAppApp").controller("ShowUsersController",["$scope","$timeout","$interval","$http","Updater","Poller",function(a,b,e,f,d,c){a.menu=get_menu();a.desktop_mode=getmode();a.updater=d;a.mode="";a.users=[];a.user={id:-1,name:"",pin:"",level:3};a.user_level=user_level;a.min_pin_len=4;a.max_pin_len=6;a.max_user_name=20;a.master_bit_in_caps=2;a.output_bit_in_caps=7;a.user_level_master=UserLevelEnum.MASTER;a.user_level_user=UserLevelEnum.USER;c.stopStatusRefresh();a.levels=[[],[{id:1,label:trl("Master Installer")},{id:2,label:trl("Installer")},{id:3,label:trl("Master")},{id:4,label:trl("Standard")}],[{id:2,label:trl("Installer")},{id:3,label:trl("Master")},{id:4,label:trl("Standard")}],[{id:3,label:trl("Master")},{id:4,label:trl("Standard")}],[{id:4,label:trl("Standard")}]];a.OutputUserAuthorities=[trl("Output 1"),trl("Output 2"),trl("Output 3"),trl("Output 4"),trl("Arm/Disarm"),trl("Bypass"),trl("Report")];a.UserAuthorities=[trl("Arm Only"),trl("Schedule"),trl("Master"),trl("Arm/Disarm"),trl("Bypass"),trl("Report")];a.UserAreas=[trl("Area 1"),trl("Area 2"),trl("Area 3"),trl("Area 4"),trl("Area 5"),trl("Area 6"),trl("Area 7"),trl("Area 8")];a.UserTypes=[{id:1,label:trl("Normal")},{id:2,label:trl("Door Control")}];a.isInstallerUser=function(g){return isUserInstaller(g)};a.isMasterUser=function(g){return isUserMaster(g)};a.userName=function(h,g){return(g+" ("+(h)+")")};a.UserAdd=function(){c.resetSession();if(a.mode=="Add"){return}if(!isUserMaster(a.user_level)){return}a.mode="Add";a.user={id:-1,name:"",pin:"",level:a.levels[user_level][0].id}};a.UserEdit=function(){c.resetSession();if(a.mode=="Edit"){return}a.UserForceEdit()};a.UserForceEdit=function(){a.mode="Edit";a.user={id:-1,name:"",pin:"",level:3};a.UsersGet()};a.UserChange=function(){a.UsersGet()};a.UserDelete=function(){c.resetSession();if(a.mode!="Edit"){return}if(!isUserMaster(a.user_level)){return}a.user.name="";a.user.pin="";a.user.level=0;a.updater.sendUpdate(a,undefined,a.user,a.updater.cmdEnum.USER_SET,function(g){resultAlert(g)});a.UserForceEdit()};a.UserSave=function(){c.resetSession();if(a.user.output==1&&(a.user.caps&(1<<a.master_bit_in_caps))){a.user.level=a.user_level_master}else{a.user.level=a.user_level_user}a.updater.sendUpdate(a,undefined,a.user,a.updater.cmdEnum.USER_SET,function(g){resultAlert(g)});a.UserForceEdit()};a.UsersGet=function(){a.updater.sendUpdate(a,undefined,{id:a.user.id},a.updater.cmdEnum.USERS_GET,function(g){var h=g;a.users=h.users;if(a.user.id==-1){a.user.id=a.users[0].id}a.user=h.user;if(a.user.pin.length==0){a.user.par=255;a.user.caps=112}a.user.output=(a.user.caps&(1<<a.output_bit_in_caps))?2:1;a.UserAuths=a.user.output==2?a.OutputUserAuthorities:a.UserAuthorities})};a.UserForceEdit();a.UserSetType=function(){if(a.user.output==2){a.UserAuths=a.OutputUserAuthorities;a.user.caps|=(1<<a.output_bit_in_caps)}else{a.user.caps&=~(1<<a.output_bit_in_caps);a.UserAuths=a.UserAuthorities}};a.isAuthSelected=function(g){if(a.user.caps&(1<<a.output_bit_in_caps)){return a.user.caps&(1<<(g))}else{return a.user.caps&(1<<(g+1))}};a.updateAuthSelection=function(g,j){var h=g.target;var i=h.checked?1:0;if(a.user.output!=2){j=j+1}if(i>0){a.user.caps|=(1<<(j))}else{a.user.caps&=~(1<<(j))}};a.isAreaSelected=function(g){return a.user.par&(1<<g)};a.updateAreaSelection=function(g,j){var h=g.target;var i=h.checked?1:0;if(i>0){a.user.par|=(1<<j)}else{a.user.par&=~(1<<j)}};a.getAddClass=function(g){if((a.mode=="Edit")&&isUserMaster(a.user_level)){return"bg-blu active"}else{return"bg-gry disabled"}};a.getEditClass=function(g){if(a.mode=="Edit"){return"bg-gry disabled"}else{return"bg-blu active"}};a.getDeleteClass=function(g){if((a.mode=="Edit")&&isUserMaster(a.user_level)){return"bg-blu active"}else{return"bg-gry disabled"}};a.getSaveClass=function(g){if((a.mode=="Edit")&&(a.user.pin.length>=a.min_pin_len&&a.user.pin.length<=a.max_pin_len&&a.user.name.length>=1&&a.user.name.length<=a.max_user_name)){return"bg-blu active"}else{return"bg-gry disabled"}}}]);angular.module("ngAppApp").controller("ShowSettingsController",["$scope","$timeout","$interval","$http","Updater","Poller",function(o,w,q,y,a,x){o.menu=get_menu();o.desktop_mode=getmode();o.updater=a;o.poller=x;var r=8;var c=16;var A;o.settings_menu=[];o.settings={};o.uc_status={};o.user_level=user_level;var j="uc331/v_uc331_0.226".lastIndexOf("_");o.webpages_ver=j>0?"uc331/v_uc331_0.226".substring(j+1):"Error";o.panels=[{id:0,label:"Automatic/Not Configured"},{id:35,label:"Voice Dialer"}];o.enables=[{id:0,label:trl("Disabled")},{id:1,label:trl("Enabled")}];o.dhcps=[{id:0,label:trl("Static")},{id:1,label:trl("DHCP")}];o.wifi_securities=[{id:0,label:"None"},{id:1,label:"WEP"},{id:2,label:"WPA"},{id:3,label:"WPA2"}];o.pin_modes=[{id:0,label:"Disabled"},{id:1,label:"Input"},{id:2,label:"Output"}];o.ip_senses=[{id:0,label:"Low"},{id:1,label:"High"}];o.op_senses=[{id:1,label:"High"},{id:2,label:"Low"}];o.op_types=[{id:5,label:"Comms Fault"}];o.keyswitch_modes=[{id:0,label:"Disabled"},{id:1,label:"Pulse"},{id:2,label:"Maintained"}];o.keyswitch_in_polarity=[{id:0,label:"Armed=Low,  Disarmed=High"},{id:1,label:"Armed=High, Disarmed=Low"}];o.keyswitch_out_polarity=[[],[{id:0,label:"Low"},{id:1,label:"High"}],[{id:0,label:"Arm=Low,  Disarm=High"},{id:1,label:"Arm=High, Disarm=Low"}]];var f=0;var h=0;var d=undefined;var b=false;var g;var e;var p=false;o.CSFilterCategories=[trl("Alarms"),trl("Restores"),trl("Opening/Closing"),trl("Bypass"),trl("Zone Trouble"),trl("Power Trouble"),trl("Tampers"),trl("Test Reports"),trl("System Trouble"),trl("Failure To Report"),trl("Sensor Trouble"),trl("Start/End Program Mode"),trl("Cancel"),trl("Recent Close")];o.EmailFilterCategories=[trl("Video"),trl("System"),trl("Power"),trl("Arm/Disarm"),trl("Alarm")];o.selector_item={id:0,name:trl("Email")+" 1"};o.num_emails=8;o.num_ip_reports=2;o.selectors_menu=[];for(var s=0;s<o.num_emails;s++){o.selectors_menu.push({id:s,name:trl("Email")+" "+(s+1)})}for(var s=0;s<o.num_ip_reports;s++){o.selectors_menu.push({id:o.num_emails+s,name:trl("IP Report")+" "+(s+1)})}o.ip_report_menu=[{id:0,name:trl("Disabled")},{id:1,name:trl("UltraSync")},{id:2,name:trl("OH CID IP format")},{id:3,name:trl("OH SIA IP format")},{id:4,name:trl("OH XSIA IP format")}];o.ip_report_item={id:0,name:trl("Disabled")};o.languages=[{id:0,name:trl("English")},{id:1,name:trl("German")},{id:2,name:trl("Dutch")},{id:3,name:trl("Belgian-Dutch")},{id:4,name:trl("Belgian-French")},{id:5,name:trl("French")},{id:6,name:trl("Italian")},{id:7,name:trl("Spanish")},{id:8,name:trl("Portuguese")},{id:9,name:trl("Greek")}];o.tz_hours_menu=[{id:0,name:trl("0 (GMT)")},{id:1,name:trl("+1 Brussels")},{id:2,name:trl("2")},{id:3,name:trl("3")},{id:4,name:trl("4")},{id:5,name:trl("5")},{id:6,name:trl("6")},{id:7,name:trl("7")},{id:8,name:trl("8 Perth")},{id:9,name:trl("9")},{id:10,name:trl("+10 Sydney")},{id:11,name:trl("11")},{id:12,name:trl("12")},{id:13,name:trl("13")},{id:14,name:trl("-1")},{id:15,name:trl("-2")},{id:16,name:trl("-3")},{id:17,name:trl("-4")},{id:18,name:trl("-5 New York")},{id:19,name:trl("-6 Chicago")},{id:20,name:trl("-7 Denver")},{id:21,name:trl("-8 Los Angeles")},{id:22,name:trl("-9")},{id:23,name:trl("-10")},{id:24,name:trl("-11")},{id:25,name:trl("-12")}];o.dst_months_menu=[{id:0,name:trl("Disabled")},{id:1,name:trl("Jan")},{id:2,name:trl("Feb")},{id:3,name:trl("Mar")},{id:4,name:trl("Apr")},{id:5,name:trl("May")},{id:6,name:trl("Jun")},{id:7,name:trl("Jul")},{id:8,name:trl("Aug")},{id:9,name:trl("Sep")},{id:10,name:trl("Oct")},{id:11,name:trl("Nov")},{id:12,name:trl("Dec")}];o.dst_weeks_menu=[{id:0,name:trl("First Sunday")},{id:1,name:trl("Second Sunday")},{id:2,name:trl("Third Sunday")},{id:3,name:trl("Fourth Sunday")},{id:4,name:trl("Last Sunday")}];o.tz_mins_menu=[{id:0,name:"0"},{id:1,name:"15"},{id:2,name:"30"},{id:3,name:"45"}];o.scenes_menu=[];o.scenes_menu_item={id:0,name:trl("Scene")+" "+1};for(var s=0;s<r;s++){o.scenes_menu.push({id:s,name:trl("Scene")+" "+(s+1)})}o.devices_menu=[];o.devices_menu_item={id:0,name:trl("Device")+" "+1};for(var s=0;s<c;s++){o.devices_menu.push({id:s,name:trl("Device")+" "+(s+1)})}o.scene_triggers=[{id:0,label:trl("None")},{id:1,label:trl("Area Armed Away")},{id:2,label:trl("Area Armed Stay")},{id:3,label:trl("Area Alarm")},{id:4,label:trl("Zone Open")},{id:5,label:trl("Zone Not Open")},{id:6,label:trl("Zone Alarm")},{id:7,label:trl("Geo Radius Entered")},{id:8,label:trl("Geo Radius Exited")}];o.dev_types=[{id:0,label:trl("Disabled")},{id:1,label:trl("Output")},{id:2,label:trl("Trigger Camera Video Clip")}];o.dev_modes=[{id:0,label:trl("Disabled")},{id:1,label:trl("On")},{id:2,label:trl("Off")}];o.isInstallerUser=function(i){return isUserInstaller(i)};o.isMasterUser=function(i){return isUserMaster(i)};o.trl=function(i){return trl(i)};o.checkAreaTrigger=function(i){if(i>=1&&i<=3){return true}return false};o.checkZoneTrigger=function(i){if(i>=4&&i<=6){return true}return false};o.getScanStr=function(i){return o.ettings.scan_cam?trl("Scanning..."):trl("Scan For New Cameras")};o.isSelected=function(B,i){if(i<o.num_emails){return o.settings.r_selector[i]&(1<<B)}else{return o.settings.oh_cfg[i-o.num_emails].filter&(1<<B)}};o.updateSelection=function(B,E,i){var C=B.target;var D=C.checked?1:0;if(i<o.num_emails){if(D>0){o.settings.r_selector[i]|=(1<<E)}else{o.settings.r_selector[i]&=~(1<<E)}}else{if(D>0){o.settings.oh_cfg[i-o.num_emails].filter|=(1<<E)}else{o.settings.oh_cfg[i-o.num_emails].filter&=~(1<<E)}}};function k(i){o.uc_status=i;n()}function v(){o.cam_menu=[];o.area_triggers=[{id:0,name:trl("Disabled")}];o.zones_triggers=[{id:0,name:trl("Disabled")}];for(var B in o.settings.areas){var C=1+parseInt(B);if(o.settings.areas[B].length>0){o.area_triggers.push({id:C,name:o.settings.areas[B]})}else{o.area_triggers.push({id:C,name:trl("Area")+" "+C})}}for(var B in o.settings.cameras){if(o.settings.cameras[B].id>=0){o.cam_menu.push(o.settings.cameras[B])}}for(var B in o.settings.zones){var C=1+parseInt(B);if(o.settings.zones[B].length>0){o.zones_triggers.push({id:C,name:o.settings.zones[B]})}else{o.zones_triggers.push({id:C,name:trl("Zone")+" "+C})}}}function z(i){o.settings=i;if(o.settings.scan_cam==0&&p==true){p=false;x.stopStatusRefresh()}if(isUserMaster(o.user_level)||isUserInstaller(o.user_level)){o.updater.sendUpdate(o,undefined,null,o.updater.cmdEnum.SCENES_GET,function(B){o.settings.scenes=B.scenes;o.settings_orig=JSON.parse(JSON.stringify(o.settings))});v()}}function u(){o.updater.sendUpdate(o,undefined,null,o.updater.cmdEnum.CONFIG_GET,function(i){o.settings=i;if(isUserMaster(o.user_level)||isUserInstaller(o.user_level)){o.updater.sendUpdate(o,undefined,null,o.updater.cmdEnum.SCENES_GET,function(B){o.settings.scenes=B.scenes;o.settings_orig=JSON.parse(JSON.stringify(o.settings))});v()}})}function m(){var B={};for(var i in o.settings_orig){if(o.settings_orig.hasOwnProperty(i)){if(JSON.stringify(o.settings_orig[i])!=JSON.stringify(o.settings[i])){B[i]=o.settings[i];o.settings_orig[i]=JSON.parse(JSON.stringify(o.settings[i]))}}}return B}function t(){o.updater.sendUpdate(o,undefined,null,o.updater.cmdEnum.STATUS_GET,k)}o.menu_change=function(){var i=o.settings_menu.indexOf(o.settings_item);if(i==1){t();o.poller.setStatusRefresh(STATUS_REFRESH_TICK,o,o.updater.cmdEnum.STATUS_GET,k)}else{x.stopStatusRefresh()}x.resetSession()};o.MenuUp=function(){var i=Math.max(o.settings_menu.indexOf(o.settings_item)-1,0);o.settings_item=o.settings_menu[i];o.menu_change()};o.MenuDown=function(){var i=Math.min(o.settings_menu.indexOf(o.settings_item)+1,o.settings_menu.length-1);o.settings_item=o.settings_menu[i];o.menu_change()};o.CopyChangedNames=function(){x.resetSession();o.updater.sendUpdate(o,undefined,null,o.updater.cmdEnum.COPY_CHANGED_NAMES,function(i){resultAlert(i)})};o.CopyAllNames=function(){x.resetSession();o.updater.sendUpdate(o,undefined,null,o.updater.cmdEnum.COPY_ALL_NAMES,function(i){resultAlert(i)})};o.StartScan=function(){x.resetSession();o.updater.sendUpdate(o,undefined,null,o.updater.cmdEnum.SCAN_CAMERAS,undefined);p=true;o.settings.scan_cam=1;o.poller.setStatusRefresh(STATUS_REFRESH_TICK,o,o.updater.cmdEnum.CONFIG_GET,z)};o.getButtonClassScan=function(){if(o.settings.scan_cam>0){return"bg-red"}else{return"bg-blu"}};o.RemoveCam=function(i){o.settings.cameras[i].id=-1;v()};function n(){var i=o.settings.device_region;if(isUserInstaller(user_level)){o.settings_menu=[trl("Device Details"),trl("Connection Status"),trl("System"),trl("Network Settings"),trl("Cellular"),trl("UltraSync"),trl("Name Editor"),trl("Camera Configuration"),trl("Reports"),trl("Scenes"),trl("Default")]}else{if(user_level==UserLevelEnum.MASTER){o.settings_menu=[trl("Device Details"),trl("Connection Status"),trl("Name Editor"),trl("Camera Configuration"),trl("Scenes")]}else{o.settings_menu=[trl("Device Details"),trl("Connection Status")]}}if(i==menu_str[WORDS_EMEA]){g=12;e=6}else{if(i==menu_str[WORDS_AMERICAS]){g=12;e=4}else{if(i==menu_str[WORDS_AUSTRALIA]){g=12;e=4}}}if(typeof o.settings_item==="undefined"){o.settings_item=o.settings_menu[0]}}function l(){var O;var R=25;var G;var Q=8;var F=new RegExp(trl("^[!#$'*+,-.0123456789=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz ]*$"));var P=new RegExp("^[!#$'*+,-.0123456789=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz ]*$");var K=new RegExp("^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]).)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9])$");var C=new RegExp("(^$|^.*@.*..*$)");for(O in o.settings){G=false;for(var H=1;H<=R;H++){G|=(O=="user"+H+"_pin")}if(G==true&&(b==false)){if(o.settings.hasOwnProperty(O)){if(o.settings[O]===undefined){var N=O.split("_");alert(N[0]+" "+N[1]+" "+trl("length is too short ($$ characters min)").replace("$$",e));o.settings[O]="";return false}if(o.settings[O].length!==0){if(o.settings[O].length<e){var N=O.split("_");alert(N[0]+" "+N[1]+" "+trl("length is too short ($$ characters min)").replace("$$",e));o.settings[O]="";return false}if(o.settings[O].length>g){var N=O.split("_");alert(N[0]+" "+N[1]+" "+trl("length is too long ($$ characters max)").replace("$$",g));o.settings[O]="";return false}}}}}if(!F.test(o.settings.ent)){alert(trl("Entry contains invalid characters"));return false}if(!F.test(o.settings.exit)){alert(trl("Exit contains invalid characters"));return false}for(var D in o.settings.areas){var J=1+parseInt(D);if(!F.test(o.settings.areas[D])){alert(trl("Area contains invalid characters")+"("+J+")");return false}}for(var M in o.settings.zones){var E=1+parseInt(M);if(!F.test(o.settings.zones[M])){alert(trl("Zone contains invalid characters")+"("+E+")");return false}}for(var I in o.settings.scenes){var B=1+parseInt(I);if(!F.test(o.settings.scenes[I].na)){alert(trl("Scene name contains invalid characters")+"("+B+")");return false}}if(isUserInstaller(user_level)){if(!P.test(o.settings.installer)||o.settings.installer.length==0){alert(trl("Installer name may only contain English characters"));return false}for(var L in o.settings.r_address){if(!C.test(o.settings.r_address[L])){alert(trl("Email address contains invalid characters"));return false}}if(o.settings.web_passcode.length<Q){alert(trl("Passcode length must be $$ digits").replace("$$",Q));return false}}b=false;return true}o.MenuSave=function(){x.resetSession();if(l()){o.updater.sendUpdate(o,undefined,m(),o.updater.cmdEnum.CONFIG_SET,function(i){resultAlert(i)})}};o.ResetToDefaults=function(){x.resetSession();if(confirm(trl("Reset to factory defaults?"))){o.updater.sendUpdate(o,undefined,null,o.updater.cmdEnum.FACTORY_DEFAULT,function(i){resultAlert(i)})}};t();if(user_level!=UserLevelEnum.USER){u()}o.menu_change();o.$on("$destroy",function(){x.stopStatusRefresh()})}]);angular.module("ngAppApp").controller("ShowKeypadController",["$scope","$timeout","$interval","$http","Updater","Poller",function(i,d,f,h,g,c){i.display="";i.menu=get_menu();i.desktop_mode=getmode();i.updater=g;c.resetSession();i.poller=c;var a=null;var b=1500;function e(j){i.display=j.di}c.setStatusRefresh(STATUS_REFRESH_TICK,i,i.updater.cmdEnum.DISPLAY_GET,e);i.sentChars="";i.sentFree="";i.kpChars=[["1","2","3"],["4","5","6"],["7","8","9"],["*","0","#"]];i.sendChar=function(j){i.sentChars+=j;if(a!=null){d.cancel(a);a=null}a=d(function(){i.updater.sendUpdate(i,undefined,{dt:i.sentChars},i.updater.cmdEnum.KPDATA_SEND,function(k){e(k)});i.sentChars=""},b)};i.sendStr=function(){i.updater.sendUpdate(i,undefined,{dt:i.sentFree},i.updater.cmdEnum.KPDATA_SEND,function(j){e(j)});i.sentFree=""};i.$on("$destroy",function(){c.stopStatusRefresh();if(a!=null){d.stopStatusRefresh(a)}});i.updater.sendUpdate(i,undefined,null,i.updater.cmdEnum.DISPLAY_GET,e)}]);angular.module("ngAppApp").controller("ShowLogoutController",["$scope","$interval","$http","Updater",function(a,d,e,c){a.menu=get_menu();a.desktop_mode=getmode();function b(f){window.location="/login.htm"}c.sendUpdate(a,undefined,null,c.cmdEnum.LOGOUT,b)}]);